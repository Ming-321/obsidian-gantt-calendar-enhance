# å…¨å±€ç­›é€‰ç¬¦åŠŸèƒ½åˆ†ææŠ¥å‘Š

**æ—¥æœŸ**: 2026-01-12
**åˆ†æèŒƒå›´**: å…¨å±€ç­›é€‰ç¬¦çš„è§£æé€»è¾‘ä¸é¢„æœŸè®¾è®¡å¯¹æ¯”

---

## ä¸€ã€é¢„æœŸè®¾è®¡è§„èŒƒ

### 1.1 ä»»åŠ¡æ¡ç›®ç»“æ„

```
åˆ—è¡¨é¡¹ + ç©ºæ ¼ + å¤é€‰æ¡† + ç©ºæ ¼ + å…¨å±€ç­›é€‰ç¬¦ + ç©ºæ ¼ + ä»»åŠ¡æ ‡ç­¾ + ç©ºæ ¼ + ä»»åŠ¡æè¿° + ç©ºæ ¼ + ä¼˜å…ˆçº§å­—æ®µ + ç©ºæ ¼ + æ—¶é—´å­—æ®µ
```

**ç¤ºä¾‹**:
```markdown
- [ ] ğŸ¯ #work #urgent å®Œæˆé¡¹ç›®æŠ¥å‘Š â« ğŸ“… 2026-01-15
- [ ] TODO #work é‡è¦ä»»åŠ¡ ğŸ”º â• 2026-01-12
- [ ] #task #frontend ä¿®å¤bug â« ğŸ›« 2026-01-13
```

### 1.2 ç­›é€‰é€»è¾‘è¦æ±‚

1. **å½“è®¾ç½®ä¸­è®¾ç½®äº†å…¨å±€ç­›é€‰ç¬¦æ—¶**:
   - å¤é€‰æ¡†åçš„**ç¬¬ä¸€ä¸ªå­—æ®µ**è¢«è§£æä¸ºå…¨å±€ç­›é€‰ç¬¦
   - ä¸è®¾ç½®é¡¹ä¸­çš„å…¨å±€ç­›é€‰ç¬¦æ¯”è¾ƒ
   - ä¸ç¬¦åˆåˆ™è¿‡æ»¤æ­¤ä»»åŠ¡

2. **å…¨å±€ç­›é€‰ç¬¦ç±»å‹**:
   - Emoji ç¬¦å· (å¦‚ `ğŸ¯`)
   - å•è¯ (å¦‚ `TODO`)
   - ç¬¦å·åŠ å•è¯ (å¦‚ `#task`)

3. **å…³é”®è¦æ±‚**:
   - å…¨å±€ç­›é€‰ç¬¦ï¼ˆå¦‚ `#task`ï¼‰ä¸åº”è¢«è¯¯è§£æä¸ºä»»åŠ¡æ ‡ç­¾

### 1.3 ä¸¤ç§åˆç†çš„ç­›é€‰é€»è¾‘

**é€»è¾‘ä¸€**: å…ˆåˆ¤æ–­æ˜¯å¦æœ‰å…¨å±€ç­›é€‰ç¬¦è®¾ç½®
- å¦‚æœæœ‰ï¼Œæå–å¤é€‰æ¡†åçš„ç¬¬ä¸€ä¸ªå­—æ®µä½œä¸ºå…¨å±€ç­›é€‰ç¬¦å­—æ®µ
- ä¸è®¾ç½®é¡¹æ¯”è¾ƒï¼Œåˆ¤å®šæ˜¯å¦ç¬¦åˆç­›é€‰æ¡ä»¶

**é€»è¾‘äºŒ**: å…ˆç»Ÿä¸€è§£ææ‰€æœ‰ä»»åŠ¡ï¼Œå†è¿›è¡ŒäºŒæ¬¡ç­›é€‰
- ä¸åœ¨è§£æé˜¶æ®µè¿‡æ»¤
- åœ¨è·å–ä»»åŠ¡åˆ—è¡¨åï¼Œæ ¹æ®å…¨å±€ç­›é€‰ç¬¦è¿›è¡Œè¿‡æ»¤

---

## äºŒã€å½“å‰å®ç°åˆ†æ

### 2.1 ä»£ç æ–‡ä»¶ä½ç½®

| æ–‡ä»¶ | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| è®¾ç½®ç•Œé¢ | `src/settings/builders/TaskViewSettingsBuilder.ts` | ç”¨æˆ·è®¾ç½®å…¨å±€ç­›é€‰ç¬¦ |
| ç­›é€‰é€»è¾‘ | `src/tasks/taskParser/step2.ts` | `passesGlobalFilter` å’Œ `removeGlobalFilter` |
| ä¸»è§£ææµç¨‹ | `src/tasks/taskParser/main.ts` | ä»»åŠ¡è§£æä¸»å…¥å£ |
| TaskStore | `src/TaskStore.ts` | ä»»åŠ¡ç¼“å­˜ç®¡ç† |

### 2.2 å½“å‰å®ç°æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ç”¨æˆ·åœ¨è®¾ç½®ç•Œé¢è¾“å…¥å…¨å±€ç­›é€‰ç¬¦                                 â”‚
â”‚    TaskViewSettingsBuilder.ts:25                               â”‚
â”‚    this.plugin.settings.globalTaskFilter = value;  // ç›´æ¥èµ‹å€¼  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. TaskStore åˆå§‹åŒ–æ—¶ trim ç­›é€‰ç¬¦                               â”‚
â”‚    TaskStore.ts:121                                            â”‚
â”‚    this.globalTaskFilter = (globalTaskFilter || '').trim();    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Step1: è§£æä»»åŠ¡è¡Œï¼Œæå– contentï¼ˆå¤é€‰æ¡†åçš„éƒ¨åˆ†ï¼‰            â”‚
â”‚    step1.ts:86-92                                              â”‚
â”‚    parseTaskLine(line) â†’ { indent, listMarker,                 â”‚
â”‚                            checkboxStatus, content }            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Step2: æ£€æŸ¥å…¨å±€ç­›é€‰ç¬¦                                       â”‚
â”‚    step2.ts:51-56                                              â”‚
â”‚    passesGlobalFilter(rawContent, globalTaskFilter)            â”‚
â”‚                                                              â”‚
â”‚    å®ç°: content.trim().startsWith(globalTaskFilter)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Step2: ç§»é™¤å…¨å±€ç­›é€‰ç¬¦å‰ç¼€                                   â”‚
â”‚    step2.ts:79-84                                              â”‚
â”‚    removeGlobalFilter(rawContent, globalTaskFilter)            â”‚
â”‚                                                              â”‚
â”‚    å®ç°: content.replace(/^\s*${filter}\s*/, '')               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Step3: æ£€æµ‹ä»»åŠ¡æ ¼å¼                                         â”‚
â”‚    step3.ts:71-76                                              â”‚
â”‚    detectFormat(contentWithoutFilter, enabledFormats)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Step4: è§£æä»»åŠ¡å±æ€§                                         â”‚
â”‚    utils.ts:45-64                                              â”‚
â”‚    extractTaskDescription(content) â†’ ç§»é™¤æ‰€æœ‰å…ƒæ•°æ®æ ‡è®°        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 æ ¸å¿ƒä»£ç åˆ†æ

#### passesGlobalFilter å‡½æ•° (step2.ts:51-56)

```typescript
export function passesGlobalFilter(content: string, globalTaskFilter?: string): boolean {
    if (!globalTaskFilter) return true;

    const trimmedContent = content.trim();
    return trimmedContent.startsWith(globalTaskFilter);  // âš ï¸ é—®é¢˜1
}
```

**é—®é¢˜**:
- ä½¿ç”¨ `startsWith()` æ£€æŸ¥å†…å®¹æ˜¯å¦ä»¥ç­›é€‰ç¬¦**å¼€å¤´**
- ä½†æ²¡æœ‰æå–**ç¬¬ä¸€ä¸ªå­—æ®µ**è¿›è¡Œæ¯”è¾ƒ
- å¦‚æœå…¨å±€ç­›é€‰ç¬¦æ˜¯ `#task`ï¼Œä»»åŠ¡å†…å®¹æ˜¯ `#task #work æè¿°`ï¼Œå¯ä»¥åŒ¹é…
- ä½†å¦‚æœä»»åŠ¡å†…å®¹æ˜¯ `å…¶ä»–å†…å®¹ #task æè¿°`ï¼Œä¼šå¤±è´¥ï¼ˆç¬¦åˆé¢„æœŸï¼‰

#### removeGlobalFilter å‡½æ•° (step2.ts:79-84)

```typescript
export function removeGlobalFilter(content: string, globalTaskFilter?: string): string {
    if (!globalTaskFilter) return content;

    const escapedFilter = escapeRegExp(globalTaskFilter);
    return content.replace(new RegExp(`^\s*${escapedFilter}\s*`), '');  // âš ï¸ é—®é¢˜2
}
```

**é—®é¢˜**:
- ç§»é™¤ç­›é€‰ç¬¦åï¼Œå‰©ä½™å†…å®¹å¯èƒ½ä»åŒ…å«ç­›é€‰ç¬¦å­—ç¬¦ä¸²
- ä¾‹å¦‚ï¼šç­›é€‰ç¬¦ `#task`ï¼Œå†…å®¹ `#task #taskwork`
- ç§»é™¤åå˜æˆ `#taskwork`ï¼Œå¯èƒ½å¯¼è‡´æ ‡ç­¾è§£æé”™è¯¯

#### extractTaskDescription å‡½æ•° (utils.ts:45-64)

```typescript
export function extractTaskDescription(content: string): string {
    let text = content;

    // ç§»é™¤ Tasks emoji ä¼˜å…ˆçº§æ ‡è®°
    text = text.replace(RegularExpressions.DescriptionExtraction.removePriorityEmoji, ' ');

    // ç§»é™¤ Tasks emoji æ—¥æœŸå±æ€§
    text = text.replace(RegularExpressions.DescriptionExtraction.removeTasksDate, ' ');

    // ç§»é™¤ Dataview [field:: value] å—
    text = text.replace(RegularExpressions.DescriptionExtraction.removeDataviewField, ' ');

    // ç§»é™¤æ ‡ç­¾ï¼ˆä½¿ç”¨ç»Ÿä¸€æ­£åˆ™å…¥å£ï¼‰
    text = text.replace(RegularExpressions.DescriptionExtraction.removeTags, ' ');

    // æŠ˜å å¤šä½™ç©ºæ ¼å¹¶ä¿®å‰ªé¦–å°¾ç©ºæ ¼
    text = text.replace(RegularExpressions.DescriptionExtraction.collapseWhitespace, ' ').trim();

    return text;
}
```

**é—®é¢˜**:
- æ ‡ç­¾æ­£åˆ™: `/#([a-zA-Z\u4e00-\u9fa5][a-zA-Z0-9_\u4e00-\u9fa5]*)\s*/g`
- å¦‚æœå…¨å±€ç­›é€‰ç¬¦æ˜¯ `#task`ï¼Œç§»é™¤åå®ƒä»ä¼šè¢«å½“ä½œæ ‡ç­¾å¤„ç†
- è™½ç„¶ `removeGlobalFilter` å…ˆæ‰§è¡Œï¼Œä½†å¦‚æœå‰©ä½™å†…å®¹ä¸­æœ‰ `#` å¼€å¤´çš„è¯ï¼Œä»ä¼šè¢«æå–ä¸ºæ ‡ç­¾

---

## ä¸‰ã€é—®é¢˜åˆ†æ

### 3.1 ä¸»è¦é—®é¢˜æ€»ç»“

| é—®é¢˜ | ä¸¥é‡ç¨‹åº¦ | æè¿° |
|------|----------|------|
| è®¾ç½®ç•Œé¢æœª trim è¾“å…¥ | ä¸­ | ç”¨æˆ·è¾“å…¥çš„ç­›é€‰ç¬¦å¯èƒ½åŒ…å«å°¾éšç©ºæ ¼ï¼Œä¸ TaskStore å¤„ç†ä¸ä¸€è‡´ |
| startsWith ä¸¥æ ¼åŒ¹é… | é«˜ | ä½¿ç”¨ `startsWith()` è€Œéæå–ç¬¬ä¸€ä¸ªå­—æ®µæ¯”è¾ƒ |
| ç­›é€‰ç¬¦å¯èƒ½è¢«è§£æä¸ºæ ‡ç­¾ | é«˜ | å¦‚æœç­›é€‰ç¬¦æ˜¯ `#task` æ ¼å¼ï¼Œå¯èƒ½è¢«è¯¯è§£æä¸ºæ ‡ç­¾ |
| removeGlobalFilter ä¸å½»åº• | ä¸­ | æ­£åˆ™ `^\s*${filter}\s*` åªç§»é™¤ä¸€æ¬¡åŒ¹é… |

### 3.2 å…·ä½“åœºæ™¯åˆ†æ

#### åœºæ™¯ A: ç­›é€‰ç¬¦ä¸º `#task`

**ä»»åŠ¡è¡Œ**: `- [ ] #task #work å®Œæˆä»»åŠ¡ â« ğŸ“… 2026-01-15`

**å½“å‰å¤„ç†æµç¨‹**:
1. `rawContent` = `#task #work å®Œæˆä»»åŠ¡ â« ğŸ“… 2026-01-15`
2. `passesGlobalFilter`: `#task #work ...`.startsWith(`#task`) â†’ âœ… true
3. `removeGlobalFilter`: ç§»é™¤ `#task ` â†’ `#work å®Œæˆä»»åŠ¡ â« ğŸ“… 2026-01-15`
4. `extractTags`: æå– `work` ä½œä¸ºæ ‡ç­¾ â†’ âœ… æ­£ç¡®
5. `detectFormat`: æ£€æµ‹åˆ° `â«` å’Œ `ğŸ“…` â†’ 'tasks' â†’ âœ… æ­£ç¡®

**ç»“è®º**: æ­¤åœºæ™¯å·¥ä½œæ­£å¸¸

#### åœºæ™¯ B: ç­›é€‰ç¬¦ä¸º `TODO`

**ä»»åŠ¡è¡Œ**: `- [ ] TODO #work å®Œæˆä»»åŠ¡ â« ğŸ“… 2026-01-15`

**å½“å‰å¤„ç†æµç¨‹**:
1. `rawContent` = `TODO #work å®Œæˆä»»åŠ¡ â« ğŸ“… 2026-01-15`
2. `passesGlobalFilter`: `TODO #work ...`.startsWith(`TODO`) â†’ âœ… true
3. `removeGlobalFilter`: ç§»é™¤ `TODO ` â†’ `#work å®Œæˆä»»åŠ¡ â« ğŸ“… 2026-01-15`
4. åç»­å¤„ç†æ­£å¸¸

**ç»“è®º**: æ­¤åœºæ™¯å·¥ä½œæ­£å¸¸

#### åœºæ™¯ C: ç­›é€‰ç¬¦ä¸º `#task`ï¼Œä»»åŠ¡è¡Œæœ‰é¢å¤–ç©ºæ ¼

**ä»»åŠ¡è¡Œ**: `- [ ]  #task  #work  å®Œæˆä»»åŠ¡`

**å½“å‰å¤„ç†æµç¨‹**:
1. `rawContent` = ` #task  #work  å®Œæˆä»»åŠ¡`
2. `passesGlobalFilter`: `#task  #work  ...`.startsWith(`#task`) â†’ âŒ false
   - å› ä¸º `trim()` åæ˜¯ `#task  #work  ...`ï¼Œ`#task` åœ¨å¼€å¤´ï¼Œåº”è¯¥åŒ¹é… âœ…
   - ç­‰ç­‰ï¼Œ`trim()` åªç§»é™¤é¦–å°¾ç©ºæ ¼ï¼Œ`#task  #work  ...` ä»¥ `#task` å¼€å¤´
   - `startsWith('#task')` åº”è¯¥è¿”å› true
   - æ­¤åœºæ™¯åº”è¯¥å·¥ä½œæ­£å¸¸ âœ…

#### åœºæ™¯ D: ç”¨æˆ·æŠ¥å‘Šçš„é—®é¢˜åœºæ™¯

**ä»»åŠ¡è¡Œ**: `- [ ] TODO  æµ‹è¯•å…¨å±€ç­›é€‰ç¬¦å· â• 2026-01-12 ğŸ“… 2026-01-12`

**å½“å‰å¤„ç†æµç¨‹**:
1. `rawContent` = `TODO  æµ‹è¯•å…¨å±€ç­›é€‰ç¬¦å· â• 2026-01-12 ğŸ“… 2026-01-12`
2. `passesGlobalFilter`:
   - `trimmedContent` = `TODO  æµ‹è¯•å…¨å±€ç­›é€‰ç¬¦å· â• 2026-01-12 ğŸ“… 2026-01-12`
   - `startsWith('TODO')` â†’ âœ… true
3. `removeGlobalFilter`: ç§»é™¤ `TODO  ` (æ­£åˆ™ `\s*` ä¼šåŒ¹é…ç­›é€‰ç¬¦åçš„ç©ºæ ¼)
   - ç»“æœ: `æµ‹è¯•å…¨å±€ç­›é€‰ç¬¦å· â• 2026-01-12 ğŸ“… 2026-01-12`
4. `detectFormat`: æ£€æµ‹åˆ° `â• 2026-01-12` â†’ 'tasks' â†’ âœ… æ­£ç¡®
5. åç»­å¤„ç†æ­£å¸¸

**ç»“è®º**: æŒ‰ç…§ä»£ç é€»è¾‘ï¼Œæ­¤åœºæ™¯åº”è¯¥å·¥ä½œæ­£å¸¸

### 3.3 æ½œåœ¨é—®é¢˜

**é—®é¢˜: ç­›é€‰ç¬¦ä¸æ ‡ç­¾å‰ç¼€å†²çª**

å¦‚æœå…¨å±€ç­›é€‰ç¬¦è®¾ç½®ä¸º `#work`:
1. ä»»åŠ¡è¡Œ: `- [ ] #work é‡è¦ä»»åŠ¡`
2. `removeGlobalFilter` ç§»é™¤ `#work `
3. å‰©ä½™: `é‡è¦ä»»åŠ¡`
4. `extractTags` ä¸ä¼šæå–åˆ° `work` â†’ âœ… æ­£ç¡®

ä½†å¦‚æœä»»åŠ¡è¡Œæ˜¯: `- [ ] #work #work é‡è¦ä»»åŠ¡`
1. `removeGlobalFilter` ç§»é™¤ç¬¬ä¸€ä¸ª `#work `
2. å‰©ä½™: `#work é‡è¦ä»»åŠ¡`
3. `extractTags` ä¼šæå– `work` ä½œä¸ºæ ‡ç­¾ â†’ âš ï¸ å¯èƒ½ä¸ç¬¦åˆé¢„æœŸ

---

## å››ã€ä¸é¢„æœŸè®¾è®¡çš„å¯¹æ¯”

### 4.1 è®¾è®¡ç¬¦åˆåº¦åˆ†æ

| è®¾è®¡è¦æ±‚ | å½“å‰å®ç° | ç¬¦åˆåº¦ |
|----------|----------|--------|
| å¤é€‰æ¡†åç¬¬ä¸€ä¸ªå­—æ®µä¸ºå…¨å±€ç­›é€‰ç¬¦ | ä½¿ç”¨ `startsWith()` æ£€æŸ¥æ˜¯å¦ä»¥ç­›é€‰ç¬¦å¼€å¤´ | âš ï¸ éƒ¨åˆ†ç¬¦åˆ |
| ä¸è®¾ç½®é¡¹æ¯”è¾ƒï¼Œä¸ç¬¦åˆåˆ™è¿‡æ»¤ | âœ… é€šè¿‡ `passesGlobalFilter` å®ç° | âœ… ç¬¦åˆ |
| æ”¯æŒ Emoji ç­›é€‰ç¬¦ | âœ… `startsWith()` æ”¯æŒä»»æ„å­—ç¬¦ | âœ… ç¬¦åˆ |
| æ”¯æŒå•è¯ç­›é€‰ç¬¦ | âœ… `startsWith()` æ”¯æŒä»»æ„å­—ç¬¦ | âœ… ç¬¦åˆ |
| æ”¯æŒ `#task` æ ¼å¼ç­›é€‰ç¬¦ | âš ï¸ å¯èƒ½ä¸æ ‡ç­¾è§£æå†²çª | âš ï¸ éƒ¨åˆ†ç¬¦åˆ |
| ç­›é€‰ç¬¦ä¸åº”è¢«è§£æä¸ºæ ‡ç­¾ | âš ï¸ å¦‚æœç­›é€‰ç¬¦æ ¼å¼ä¸º `#xxx`ï¼Œå¯èƒ½è¢«è¯¯è§£æ | âŒ ä¸ç¬¦åˆ |

### 4.2 å…³é”®å·®å¼‚

**å·®å¼‚ 1: "ç¬¬ä¸€ä¸ªå­—æ®µ" çš„ç†è§£**

- **é¢„æœŸè®¾è®¡**: å¤é€‰æ¡†åçš„ç¬¬ä¸€ä¸ª**ä»¥ç©ºæ ¼åˆ†éš”çš„å­—æ®µ**
- **å½“å‰å®ç°**: æ£€æŸ¥å†…å®¹æ˜¯å¦**ä»¥ç­›é€‰ç¬¦å¼€å¤´**

**ç¤ºä¾‹è¯´æ˜**:
```markdown
- [ ] ğŸ¯ #work ä»»åŠ¡æè¿°
```

- **é¢„æœŸè®¾è®¡**: ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ `ğŸ¯`ï¼Œä¸è®¾ç½®æ¯”è¾ƒ
- **å½“å‰å®ç°**: `trim()` åå†…å®¹ä»¥ `ğŸ¯` å¼€å¤´ï¼Œæ£€æŸ¥é€šè¿‡ âœ…

```markdown
- [ ] å‰ç¼€ ğŸ¯ ä»»åŠ¡æè¿°
```

- **é¢„æœŸè®¾è®¡**: ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ `å‰ç¼€`ï¼Œä¸ `ğŸ¯` æ¯”è¾ƒå¤±è´¥
- **å½“å‰å®ç°**: `trim()` åå†…å®¹ä»¥ `å‰ç¼€` å¼€å¤´ï¼Œæ£€æŸ¥å¤±è´¥ âœ…

**ç»“è®º**: å½“å‰å®ç°åœ¨æ­£å¸¸åœºæ™¯ä¸‹ç¬¦åˆé¢„æœŸ

**å·®å¼‚ 2: `#task` æ ¼å¼ç­›é€‰ç¬¦çš„å¤„ç†**

å½“ç­›é€‰ç¬¦ä¸º `#task` æ—¶:

```markdown
- [ ] #task é‡è¦ä»»åŠ¡
```

- **é¢„æœŸ**: `#task` è¢«è¯†åˆ«ä¸ºå…¨å±€ç­›é€‰ç¬¦ï¼Œä¸è¢«è§£æä¸ºæ ‡ç­¾
- **å½“å‰**: `#task` è¢«ç§»é™¤ï¼Œ`é‡è¦ä»»åŠ¡` æ²¡æœ‰æ ‡ç­¾ â†’ âœ… ç¬¦åˆé¢„æœŸ

```markdown
- [ ] #task #work é‡è¦ä»»åŠ¡
```

- **é¢„æœŸ**: `#task` è¢«è¯†åˆ«ä¸ºå…¨å±€ç­›é€‰ç¬¦ï¼Œ`#work` è¢«è§£æä¸ºæ ‡ç­¾
- **å½“å‰**: `#task` è¢«ç§»é™¤ï¼Œå‰©ä½™ `#work é‡è¦ä»»åŠ¡`ï¼Œ`work` è¢«è§£æä¸ºæ ‡ç­¾ â†’ âœ… ç¬¦åˆé¢„æœŸ

**ç»“è®º**: å½“å‰å®ç°åœ¨æ­¤åœºæ™¯ä¸‹ä¹Ÿç¬¦åˆé¢„æœŸ

---

## äº”ã€å»ºè®®çš„ä¿®å¤æ–¹æ¡ˆ

### 5.1 é«˜ä¼˜å…ˆçº§ä¿®å¤

#### ä¿®å¤ 1: è®¾ç½®ç•Œé¢ trim ç”¨æˆ·è¾“å…¥

**æ–‡ä»¶**: `src/settings/builders/TaskViewSettingsBuilder.ts:25`

```typescript
// å½“å‰ä»£ç 
.onChange(async (value) => {
    this.plugin.settings.globalTaskFilter = value;
    await this.saveAndRefresh();
});

// ä¿®å¤å
.onChange(async (value) => {
    this.plugin.settings.globalTaskFilter = value.trim();
    await this.saveAndRefresh();
});
```

#### ä¿®å¤ 2: passesGlobalFilter é˜²å¾¡æ€§ trim

**æ–‡ä»¶**: `src/tasks/taskParser/step2.ts:51-56`

```typescript
// å½“å‰ä»£ç 
export function passesGlobalFilter(content: string, globalTaskFilter?: string): boolean {
    if (!globalTaskFilter) return true;
    const trimmedContent = content.trim();
    return trimmedContent.startsWith(globalTaskFilter);
}

// ä¿®å¤å
export function passesGlobalFilter(content: string, globalTaskFilter?: string): boolean {
    if (!globalTaskFilter) return true;
    const trimmedContent = content.trim();
    const trimmedFilter = globalTaskFilter.trim();
    return trimmedContent.startsWith(trimmedFilter);
}
```

### 5.2 å¯é€‰ä¼˜åŒ–

#### ä¼˜åŒ– 1: æå–ç¬¬ä¸€ä¸ªå­—æ®µè¿›è¡Œæ¯”è¾ƒï¼ˆä¸¥æ ¼ç¬¦åˆé¢„æœŸè®¾è®¡ï¼‰

```typescript
/**
 * æå–å¤é€‰æ¡†åçš„ç¬¬ä¸€ä¸ªå­—æ®µ
 */
function extractFirstField(content: string): string {
    const trimmed = content.trim();
    const spaceIndex = trimmed.indexOf(' ');
    if (spaceIndex === -1) {
        return trimmed; // æ²¡æœ‰ç©ºæ ¼ï¼Œæ•´ä¸ªå†…å®¹æ˜¯ç¬¬ä¸€ä¸ªå­—æ®µ
    }
    return trimmed.substring(0, spaceIndex);
}

export function passesGlobalFilter(content: string, globalTaskFilter?: string): boolean {
    if (!globalTaskFilter) return true;
    const firstField = extractFirstField(content);
    const trimmedFilter = globalTaskFilter.trim();
    return firstField === trimmedFilter;
}
```

**æ³¨æ„**: è¿™ç§ä¸¥æ ¼åŒ¹é…å¯èƒ½ç ´åç°æœ‰è¡Œä¸ºï¼Œéœ€è¦æµ‹è¯•éªŒè¯

#### ä¼˜åŒ– 2: æ”¹è¿› removeGlobalFilter

```typescript
export function removeGlobalFilter(content: string, globalTaskFilter?: string): string {
    if (!globalTaskFilter) return content;
    const trimmedFilter = globalTaskFilter.trim();
    const escapedFilter = escapeRegExp(trimmedFilter);
    // ç§»é™¤ç­›é€‰ç¬¦åŠå…¶åçš„ä¸€ä¸ªç©ºæ ¼
    return content.replace(new RegExp(`^\\s*${escapedFilter}\\s+`), '').trim();
}
```

---

## å…­ã€æµ‹è¯•ç”¨ä¾‹å»ºè®®

### 6.1 åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹

| ç”¨ä¾‹ç¼–å· | å…¨å±€ç­›é€‰ç¬¦ | ä»»åŠ¡è¡Œ | é¢„æœŸç»“æœ |
|----------|------------|--------|----------|
| T1 | `ğŸ¯` | `- [ ] ğŸ¯ ä»»åŠ¡` | âœ… é€šè¿‡ |
| T2 | `ğŸ¯` | `- [ ] å…¶ä»–ä»»åŠ¡` | âŒ è¿‡æ»¤ |
| T3 | `TODO` | `- [ ] TODO ä»»åŠ¡` | âœ… é€šè¿‡ |
| T4 | `TODO` | `- [ ] TODO #work ä»»åŠ¡` | âœ… é€šè¿‡ï¼Œæ ‡ç­¾ä¸º `work` |
| T5 | `#task` | `- [ ] #task ä»»åŠ¡` | âœ… é€šè¿‡ï¼Œæ— æ ‡ç­¾ |
| T6 | `#task` | `- [ ] #task #work ä»»åŠ¡` | âœ… é€šè¿‡ï¼Œæ ‡ç­¾ä¸º `work` |
| T7 | `#task` | `- [ ] #tasktask ä»»åŠ¡` | âŒ è¿‡æ»¤ |
| T8 | `ğŸ¯ ` (å¸¦ç©ºæ ¼) | `- [ ] ğŸ¯ ä»»åŠ¡` | âœ… é€šè¿‡ï¼ˆè®¾ç½®åº” trimï¼‰ |
| T9 | `` (ç©º) | `- [ ] ä»»æ„ä»»åŠ¡` | âœ… é€šè¿‡ï¼ˆæ— ç­›é€‰ï¼‰ |

### 6.2 è¾¹ç•Œæµ‹è¯•ç”¨ä¾‹

| ç”¨ä¾‹ç¼–å· | å…¨å±€ç­›é€‰ç¬¦ | ä»»åŠ¡è¡Œ | é¢„æœŸç»“æœ |
|----------|------------|--------|----------|
| B1 | `ğŸ¯` | `- [ ]  ğŸ¯  ä»»åŠ¡` (å¤šä¸ªç©ºæ ¼) | âœ… é€šè¿‡ |
| B2 | `ğŸ¯` | `- [ ] ğŸ¯ä»»åŠ¡` (æ— ç©ºæ ¼) | âœ… é€šè¿‡ |
| B3 | `#tag` | `- [ ] #tag #tag ä»»åŠ¡` | âœ… é€šè¿‡ï¼Œæ ‡ç­¾ä¸º `tag` |
| B4 | `TODO` | `- [ ] TODOä»»åŠ¡` (æ— ç©ºæ ¼) | âš ï¸ è§†è®¾è®¡è€Œå®š |

---

## ä¸ƒã€ç»“è®º

### 7.1 å½“å‰å®ç°æ€»ç»“

1. **åŸºæœ¬åŠŸèƒ½**: å½“å‰å®ç°çš„ `startsWith()` æ–¹æ³•åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹å¯ä»¥æ­£ç¡®å·¥ä½œ
2. **è®¾ç½®è¾“å…¥**: è®¾ç½®ç•Œé¢æ²¡æœ‰ trim ç”¨æˆ·è¾“å…¥ï¼Œå¯èƒ½å¯¼è‡´ä¸ä¸€è‡´
3. **æ ‡ç­¾å†²çª**: `#task` æ ¼å¼çš„ç­›é€‰ç¬¦å¯èƒ½ä¸æ ‡ç­¾è§£æäº§ç”Ÿè½»å¾®å†²çªï¼Œä½†å½“å‰å½±å“æœ‰é™
4. **ç”¨æˆ·æŠ¥å‘Šçš„é—®é¢˜**: æ ¹æ®ä»£ç åˆ†æï¼Œç”¨æˆ·æŠ¥å‘Šçš„åœºæ™¯åº”è¯¥èƒ½æ­£å¸¸å·¥ä½œï¼Œå¯èƒ½éœ€è¦è¿›ä¸€æ­¥è°ƒè¯•

### 7.2 å»ºè®®é‡‡å–çš„è¡ŒåŠ¨

1. **ç«‹å³ä¿®å¤**:
   - è®¾ç½®ç•Œé¢æ·»åŠ  `trim()`
   - `passesGlobalFilter` æ·»åŠ é˜²å¾¡æ€§ `trim()`

2. **è¿›ä¸€æ­¥è°ƒæŸ¥**:
   - æ”¶é›†æ›´å¤šç”¨æˆ·æŠ¥å‘Šçš„å…·ä½“å¤±è´¥åœºæ™¯
   - æ·»åŠ è°ƒè¯•æ—¥å¿—è¿½è¸ªç­›é€‰æµç¨‹
   - æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–åœ°æ–¹çš„ç­›é€‰é€»è¾‘

3. **é•¿æœŸä¼˜åŒ–**:
   - è€ƒè™‘ä½¿ç”¨"ç¬¬ä¸€ä¸ªå­—æ®µ"ä¸¥æ ¼åŒ¹é…
   - æ”¹è¿›æ ‡ç­¾æå–é€»è¾‘ï¼Œæ˜ç¡®æ’é™¤å…¨å±€ç­›é€‰ç¬¦
   - æ·»åŠ å•å…ƒæµ‹è¯•è¦†ç›–ç­›é€‰é€»è¾‘

---

## å…«ã€é™„å½•ï¼šå…³é”®ä»£ç ä½ç½®

| åŠŸèƒ½ | æ–‡ä»¶è·¯å¾„ | è¡Œå· |
|------|----------|------|
| è®¾ç½®ç•Œé¢ | `src/settings/builders/TaskViewSettingsBuilder.ts` | 18-27 |
| TaskStore | `src/TaskStore.ts` | 107-140 |
| passesGlobalFilter | `src/tasks/taskParser/step2.ts` | 51-56 |
| removeGlobalFilter | `src/tasks/taskParser/step2.ts` | 79-84 |
| ä¸»è§£ææµç¨‹ | `src/tasks/taskParser/main.ts` | 51-152 |
| æ ‡ç­¾æå– | `src/tasks/taskParser/utils.ts` | 326-341 |
| æè¿°æå– | `src/tasks/taskParser/utils.ts` | 45-64 |
